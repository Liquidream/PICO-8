pico-8 cartridge // http://www.pico-8.com
version 18
__lua__

--
-- constants/variables
--
f=3   -- car scale factor (used for shrinking when fall off track,
      -- as well as keep track of current player state)
x=19  -- starting x position
y=880 -- starting y position
r=280 -- starting rotation
s=0   -- speed/acceleration
l=1   -- lap count
g=999 -- shorthand for large number (reused a few times)
w=64  -- shorthand for number (reused a few times)
--
-- (function shorthands)
--
k=circfill
q=rectfill
e=fillp
o=camera

function _update60()

  
  e(4383)           -- set FILLP to "tile" style effect
  q(0,0,127,127,1)  -- fill screen with it (this also acts as a CLS)
  e()               -- reset (disable) FILLP effect
  o(x-w,y-w)        -- position the camera so that the player is centered
  q(0,0,200,g,9)    -- draw the track (big table)


  srand()           -- force/seed the random number gen to be constant every frame
  for i=1,3^7 do     
    z=rnd(200)      -- draw >2000 single pixels, to add a detail to the "wood" track
    u=rnd(g)        --
    pset(z,u,4)     --
  end
  e(4383)           -- set FILLP back to the "tile" style effect
  q(39,89,160,910,1)-- draw the middle "gap" of the track
  e()               -- reset the FILLP again
  q(0,865,38,867,7) -- draw the white finishing line
  e()               -- (oops! guess who wasted 3 chars leaving old code in...)

  if(f==3)then      -- if player is not "falling"...
    if(btn(0))r+=8  -- allow player to turn car
    if(btn(1))r-=8  --
    if(btn(4))s*=.95-- allow player to brake (by dropping speed)
    
    a=flr(r/32)/32  -- "snap" the player's angle to the nearest segment (out of 32)
                    -- (to avoid the car seem "jittery" with fraction angles)

    dx=cos(a)       -- calculate the player's movement vector (based on angle)
    dy=sin(a)       --
    s=min(s+.02,4)  -- auto-accelerate player's car, but cap to max speed
    x+=dx*s         -- move player position along current vector, at current speed
    y+=dy*s         -- 
    c=pget(x,y)     -- get the current pixel colour at new player position
    if(c==1)f=2.9   -- if it's dark blue, assume player has left the track, start falling
    if(y<89)v=1     -- if player's y position near top, then reset the lap "check" flag
    -- if player has been to top of track and is over the starting line, then increase lap
    if(v==1 and c==7)l+=1v=0 
  end

  o()                                -- reset the camera to (0,0), ready for UI drawing
  ?t().."\nâ–’:"..l,99,2               -- draw the current time and lap count
  k(w-dx,w-dy,f,8)k(w+dx*f,w+dy*f,f) -- draw the player's "car", by drawing circles on the
                                     -- axis of the angle that they are facing in

  if(f<3)f-=.1                       -- if player is falling, then scale them down even smaller
  if(f<0)f=3 x-=dx*s*8 y-=dy*s*8s=0  -- if player's car hits the "floor", then:
                                     --  > reset scale, 
                                     --  > move them back a small distance (based on their speed)
                                     --  > reset their speed to a standing start

  if(l>3)stop()                      -- if player exceeds 3 laps, player has completed game!  
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011177710111777171117111777101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000070700000707070007000007000000
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011171710111717177717771017101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011171710111717171717171017101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011177710711777177717771017101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011171717171011177110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011107170711071107110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011171717171011107110111011101110
00000000000000000000000000000000000000000000099999999999999999499999999999999999999900000000000000007070700070007000000000000000
11101110111011101110111011101110111011101110199999499999999999999999999999999999999911101110111011171717171011177710111011101110
11101110111011101110111011101110111011101110199999999999999999499999999999999999999411101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999949999999999999999499999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999949994999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999994999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999949999999999999999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999949999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999994999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110194999999949999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999994999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999499999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999949999999994999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999994999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110177777777777777777777777777777777777777711101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000077777777777777777777777777777777777777700000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110177777777777777777777777777777777777777711101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999499999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999994999999999988899999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999888889999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999998888888999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999998888888999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999949999999998888888999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999949999888889999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999949998888888999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999998888888999999999949999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110149999999999999998888888999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999888889999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999988899999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999949999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999999999411101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999994999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999949999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999999999999499999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199949999999999999999999999999999999999411101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999994999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999949999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
11101110111011101110111011101110111011101110199999999999999999999999999999999999999911101110111011101110111011101110111011101110
00000000000000000000000000000000000000000000099999999999999999999999999999999999999900000000000000000000000000000000000000000000
11101110111011101110111011101110111011101110199999999999999999999999999999999999999999999999999999999999999999999999999999999999
11101110111011101110111011101110111011101110199999999999999999999994999999999999999999999999949999999999999999999999999999999999
11101110111011101110111011101110111011101110199999949999999999999999999999999999999999999999999999999999999999999999949999999999
00000000000000000000000000000000000000000000099999999999949999999999999999999999999999999999999999999999999999999999999999999999
11101110111011101110111011101110111011101110199999999999999999999999999999999999999999999999999999999999999994999999999999999999
11101110111011101110111011101110111011101110199999999999999999999999999999999999999999999999999999999999999999999999999999999999
11101110111011101110111011101110111011101110199999999999999999999999999994999999999999999999999999999999999999999999999999999999
00000000000000000000000000000000000000000000099999999999999999999999999999999999999999999999999999999999999999999999999999999994
11101110111011101110111011101110111011101110199999999999999999999999999999999999999999999999999999999999999999999999999999499999
11101110111011101110111011101110111011101110199999999499999999999999999999999999999999999999999999999999999499999999999999999999
11101110111011101110111011101110111011101110199999999999999999999999949999999999999999999999999999999999999999999999999999999999
00000000000000000000000000000000000000000000099999999999999999999999999999999999999999999999999999999999999999999999999999999999
11101110111011101110111011101110111011101110199999999999999999999999999999999999999999999999999999999999999999999999999999949999
11101110111011101110111011101110111011101110199999999999999999999994999999999999999999999999999999999999999999999999999999999999
11101110111011101110111011101110111011101110199999999999999999999999999999999999999999999999999999999499999999999999999999999999
00000000000000000000000000000000000000000000099999999999999999999999999999949999999999999999999999999999999999999999999999999999
11101110111011101110111011101110111011101110199999999999999999999999999999999999999999999999999999999999999999999999999999999999
11101110111011101110111011101110111011101110199999999999999999999999999999999999999999999999999999999999999999999999999999999999
11101110111011101110111011101110111011101110199999499999999999999999999999999999999999999999999999999999999999999999999999999999
00000000000000000000000000000000000000000000094999999999999999999999999999999999999999999999999999999999999999999999999999999999
11101110111011101110111011101110111011101110199999999999999999999999999999999999999999999994499999999999999999999499999999999999
11101110111011101110111011101110111011101110199999999999999999999999999999994999999999999999999999949999999999999999999999999999
11101110111011101110111011101110111011101110199999999999999999999999999999999999499999999999999999999999999999499499999999999999
00000000000000000000000000000000000000000000099999999999999999999999999999999944999999999999999999999999999999999999999999999999
11101110111011101110111011101110111011101110199999999999999999999999999999999999999994999999999999999999999999999999999999999999
11101110111011101110111011101110111011101110199999999999999999999999999999999999999999999999999999999999999999999499999999999999
11101110111011101110111011101110111011101110199999999999999999999999999999999999999999999999999999999999999999999999999999999499
00000000000000000000000000000000000000000000099999999999999999999999999999999999999999999999999999999999999999999999999999999999
11101110111011101110111011101110111011101110199999999949999999999999999999999999999999999999999999999999999999999999999999999999
11101110111011101110111011101110111011101110199999999999999999999999999999999999999999999999999999999999999999999949999999999999
11101110111011101110111011101110111011101110199999999999999999999999999999999999999999999999999999999999999499999999999999999999
00000000000000000000000000000000000000000000099999999999999999999999999999999999999999999999999999999999999999999999999999999999

