pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- raycast (pn-mod)
-- by @freds72
local angle,cy=0.25,-96

function _update60()
 -- auto-rotate in...
 if angle>.0 then
  angle-=.1/128
  cy+=.25
 else
  angle=0
 end
end


function _draw()
	cls()
	
 --pal()
	-- draw orginal sprite when
	-- not rotating (as rotation
	-- code distorts slightly)
	--angle=0
	if angle~=0 then 
	 spr3d(8,0,123,19,cy,angle,1)
	else
	 spr(1, 3,38, 15,3)
	end
	
	local start⧗=6.5
	if t()>start⧗ then
		fadeprint("the demaking of a dynasty",12,61, (t()-start⧗)*8)
	end
end

-->8
function v2_dot(a,b)
 return a[1]*b[1]+a[2]*b[2]
end
function v2_make(a,b)
 return {b[1]-a[1],b[2]-a[2]}
end
function v2_normz(a)
 local x,z=a[1],a[2]
 local d=sqrt(x*x+z*z)
 return {
  x/d,z/d
 },d
end
function v2_add(a,b,scale)
 scale=scale or 1
 return {
  a[1]+scale*b[1],
  a[2]+scale*b[2]}  
end
-->8
function spr3d(sx,sy,sw,sh,y,angle,scale)
	-- camera pos
	local c={0,sw}	
	-- wall pos is assumed to be zero
	-- wall u/v vectors
	local v={sin(angle),-cos(angle)}
	local u={-v[2],v[1]}
	for i=0,127 do
		-- camera to screen normal vector
		-- note: could be precomputed
		local n,d=v2_normz(v2_make(c,{i-63.5,0}))
  	-- intersect wall
		local t0=(-v2_dot(c,v))/v2_dot(n,v)		
		if t0>0 then 
		 -- find projection on wall
		 local x=v2_add(c,n,t0)
		 -- project wx on wall
		 local t1=v2_dot(x,u)/(scale*sw)+0.5
		 if t1>=0 and t1<1 then
	  	local w=scale*d/t0
	  	local y0=63.5-(sh/2-y)*w
	  	-- %1: adjust flooring impact on actual span height
	   sspr(sx+sw*t1,sy,1,sh,i,y0,1,sh*w+y0%1)
	  end
	 end
	end
end
-->8

-- use red gradient
-- make with #PALETTE_MAKER
-- https://www.lexaloffle.com/bbs/?pid=68190
_pal={0,128,130,2,136,8}
-- for i,c in pairs(_pal) do
-- 	pal(i-1,c,1)
-- end
pal(_pal,1)

function fadeprint(text, x, y, fade)
 local fcol = mid(0,flr(fade),#_pal)
 print(text, x, y, fcol)
end



__gfx__
00000000000000088888000008880000000000008888888888000008888800000888008883000000888088888888888800000008888888008888888000000000
00000000000000008880000000800000000000000888000588800000888000000080000888300000080005888500008850000000588850000588850000000000
00700700000000008880000000800000000000000888000008880000888000000080000888830000080000888000000880000000088800000088800000000000
00077000000000008880000000800000000000000888000005888000888000000080000888883000080000888000000080000000088800000088800000000000
00077000000000008880000000800888005500000888000000888000888000000080000888888300080000888000080080000000088800000088800000000000
00700700000000008880000000800088088880000888000000888500888000000080000858888830080000888000080000000000088800000088800000000000
00000000000000008880000000800088800885000888000000888800888000000080000805888883080000888000880000045400088800000088800000000000
00000000000000008880000000800088500588000888000000888800888000000080000800588888380000888888880000058500088800000088800000000000
00000000000000008880000000800088000088000888000000888800888000000080000800058888880000888005880000045400088800000088800000000000
00000000000000008880000000800088000088000888000000888500888000000080000800005888880000888000580000000000088800000088800000000000
00000000000000008880000000800088000088000888000000888000888000000080000800000588880000888000080080000000088800000088800000000000
00000000000000005880000000800088000088000888000005885000588000000080000800000058880000888000000080000000088800000088800000000000
00000000000000000884000008500088000088000888000008880000088400000850000800000005880000888000000880000000088800000088800000000000
00000000000000000588500058000388300388300888000588500000058850005800005850000000580005888500008850000000588850000588850000000000
00000000000000000005888880000888800888808888888885000000000588888000088888000000080088888888888800000008888888008888888000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888880
00000000444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444440
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000088888888888888888888000000000000000000008888888888880000000088888888888800000000000000000000000000008888888888880000888888
00000088888888888888888888000000000000000000008888888888880000000088888888888800000000000000000000000000008888888888880000888888
00000088888888888888888888000000000000000000008888888888880000000088888888888800000000000000000000000000008888888888880000888888
00000088888888888888888888000000000000000000008888888888880000000088888888888800000000000000000000000000008888888888880000888888
00000000008888888888880000000000000000000000000000888800000000000000008888888888880000000000000000000000000000888800000000000022
00000000008888888888880000000000000000000000000000888800000000000000008888888888880000000000000000000000000000888800000000000022
00000000008888888888880000000000000000000000000000888800000000000000008888888888880000000000000000000000000000888800000000000022
00000000008888888888880000000000000000000000000000888800000000000000008888888888880000000000000000000000000000888800000000000022
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888000000000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888000000000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888000000000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888000000000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888800000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888800000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888800000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888800000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888888880000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888888880000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888888880000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888888880000000000000000888800000000000000
22000000008888888888880000000000000000000000000000888800000000000000008888000088888888888888888888000000000000888800000000000000
22000000008888888888880000000000000000000000000000888800000000000000008888000088888888888888888888000000000000888800000000000000
22000000008888888888880000000000000000000000000000888800000000000000008888000088888888888888888888000000000000888800000000000000
22000000008888888888880000000000000000000000000000888800000000000000008888000088888888888888888888000000000000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000008888888888888888888800000000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000008888888888888888888800000000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000008888888888888888888800000000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000008888888888888888888800000000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000888888888888888888880000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000888888888888888888880000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000888888888888888888880000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000888888888888888888880000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000000088888888888888888888888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000000088888888888888888888888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000000088888888888888888888888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000000088888888888888888888888800000000000000
22000000008888888888880000000000000000000000000000888800000000000000008888000000000000000000008888888888888888888800000000000000
22000000008888888888880000000000000000000000000000888800000000000000008888000000000000000000008888888888888888888800000000000000
22000000008888888888880000000000000000000000000000888800000000000000008888000000000000000000008888888888888888888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888000000000000000000000000888888888888888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888000000000000000000000000888888888888888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888000000000000000000000000888888888888888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888000000000000000000000000888888888888888800000000000000
00000000002222888888880000000000000000000000000000888800000000000000008888000000000000000000000000000088888888888800000000000000
00000000002222888888880000000000000000000000000000888800000000000000008888000000000000000000000000000088888888888800000000000000
00000000002222888888880000000000000000000000000000888800000000000000008888000000000000000000000000000088888888888800000000000000
00000000002222888888880000000000000000000000000000888800000000000000008888000000000000000000000000000088888888888800000000000000
00000000000000888888882222000000000000000000008888222200000000000000008888000000000000000000000000000000008888888800000000000000
00000000000000888888882222000000000000000000008888222200000000000000008888000000000000000000000000000000008888888800000000000000
00000000000000888888882222000000000000000000008888222200000000000000008888000000000000000000000000000000008888888800000000000000
00000000000000888888882222000000000000000000008888222200000000000000008888000000000000000000000000000000008888888800000000000000
00000000000000222288888888000000000000000022228888000000000000000022228888222200000000000000000000000000002222888800000000000022
00000000000000222288888888000000000000000022228888000000000000000022228888222200000000000000000000000000002222888800000000000022
00000000000000222288888888000000000000000022228888000000000000000022228888222200000000000000000000000000002222888800000000000022
00000000000000222288888888000000000000000022228888000000000000000022228888222200000000000000000000000000002222888800000000000022
00000000000000000000002222888888888888888888880000000000000000888888888888888888880000000000000000000000000000888800000000888888
00000000000000000000002222888888888888888888880000000000000000888888888888888888880000000000000000000000000000888800000000888888
00000000000000000000002222888888888888888888880000000000000000888888888888888888880000000000000000000000000000888800000000888888
00000000000000000000002222888888888888888888880000000000000000888888888888888888880000000000000000000000000000888800000000888888
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

