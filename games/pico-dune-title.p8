pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- raycast (pn-mod)
-- by @freds72
local angle,cy=0.25,-96

function _update60()
 -- auto-rotate in...
 if angle>.0 then
  angle-=.1/128
  cy+=.25
 else
  angle=0
 end
end


function _draw()
	cls()
	
	-- draw orginal sprite when
	-- not rotating (as rotation
	-- code distorts slightly)
	angle=0
	if angle~=0 then 
	 spr3d(8,0,123,19,cy,angle,1)
	else
	 spr(1, 3,38, 15,3)
	end
	
	local startâ§—=6.5
	pal()
--	if t()>startâ§— then
	 fade(t()*4)
  --pal(10,128,1)
		print("the demaking of a dynasty",12,61,8) --10
--	end
end

-->8
function v2_dot(a,b)
 return a[1]*b[1]+a[2]*b[2]
end
function v2_make(a,b)
 return {b[1]-a[1],b[2]-a[2]}
end
function v2_normz(a)
 local x,z=a[1],a[2]
 local d=sqrt(x*x+z*z)
 return {
  x/d,z/d
 },d
end
function v2_add(a,b,scale)
 scale=scale or 1
 return {
  a[1]+scale*b[1],
  a[2]+scale*b[2]}  
end
-->8
function spr3d(sx,sy,sw,sh,y,angle,scale)
	-- camera pos
	local c={0,sw}	
	-- wall pos is assumed to be zero
	-- wall u/v vectors
	local v={sin(angle),-cos(angle)}
	local u={-v[2],v[1]}
	for i=0,127 do
		-- camera to screen normal vector
		-- note: could be precomputed
		local n,d=v2_normz(v2_make(c,{i-63.5,0}))
  	-- intersect wall
		local t0=(-v2_dot(c,v))/v2_dot(n,v)		
		if t0>0 then 
		 -- find projection on wall
		 local x=v2_add(c,n,t0)
		 -- project wx on wall
		 local t1=v2_dot(x,u)/(scale*sw)+0.5
		 if t1>=0 and t1<1 then
	  	local w=scale*d/t0
	  	local y0=63.5-(sh/2-y)*w
	  	-- %1: adjust flooring impact on actual span height
	   sspr(sx+sw*t1,sy,1,sh,i,y0,1,sh*w+y0%1)
	  end
	 end
	end
end
-->8
-- fade
local fadetable={
 {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
 {1,1,129,129,129,129,129,129,129,129,0,0,0,0,0},
 {2,2,132,133,133,130,130,130,130,128,128,128,128,0,0},
 {3,3,3,3,3,131,131,129,129,129,129,0,0,0,0},
 {4,4,132,132,132,132,132,133,130,130,128,128,128,128,0},
 {5,5,133,133,133,130,130,128,128,128,128,128,129,0,0},
 {6,6,134,13,13,13,141,5,5,133,133,130,128,129,0},
 {7,6,6,6,134,134,134,13,141,5,133,133,128,128,0},
 {8,8,136,136,136,136,2,132,132,132,130,130,128,128,0},
 {9,9,9,4,4,4,4,132,132,132,133,128,128,128,0},
 {10,10,138,138,138,4,4,132,132,132,133,130,128,128,0},
 {11,139,139,139,139,3,3,3,3,129,129,0,0,0,0},
 {12,12,12,140,140,140,140,131,131,131,131,129,129,129,0},
 {13,13,141,5,5,5,133,133,130,130,128,128,129,129,0},
 {14,14,134,134,134,4,2,2,2,5,133,130,128,128,0},
 {15,143,6,134,134,134,134,141,5,5,133,130,128,128,0}
}

function fade(i)
 for c=0,15 do
  if flr(i+1)>=16 then
   pal(c,0,1)
  else
   pal(c,fadetable[c+1][flr(i+1)],1)
  end
 end
end
__gfx__
00000000000000088888000008880000000000008888888888000008888800000888008880000000888088888888888800000008888888008888888000000000
00000000000000008880000000800000000000000888000288800000888000000080000888000000080002888200008820000000288820000288820000000000
00700700000000008880000000800000000000000888000008880000888000000080000888800000080000888000000880000000088800000088800000000000
00077000000000008880000000800000000000000888000002888000888000000080000888880000080000888000000080000000088800000088800000000000
00077000000000008880000000800888002200000888000000888000888000000080000888888000080000888000080080000000088800000088800000000000
00700700000000008880000000800088088880000888000000888200888000000080000808888800080000888000080000000000088800000088800000000000
00000000000000008880000000800088800882000888000000888800888000000080000800888880080000888000880000028200088800000088800000000000
00000000000000008880000000800088200288000888000000888800888000000080000800088888080000888888880000088800088800000088800000000000
00000000000000008880000000800088000088000888000000888800888000000080000800008888880000888002880000028200088800000088800000000000
00000000000000008880000000800088000088000888000000888200888000000080000800000888880000888000280000000000088800000088800000000000
00000000000000008880000000800088000088000888000000888000888000000080000800000088880000888000080080000000088800000088800000000000
00000000000000002880000000800088000088000888000002882000288000000080000800000008880000888000000080000000088800000088800000000000
00000000000000000882000008200088000088000888000008880000088200000820000800000000880000888000000880000000088800000088800000000000
00000000000000000288200028000088000088000888000288200000028800002800002820000000280002888200008820000000288820000288820000000000
00000000000000000002888880000888800888808888888882000000000288888000088888000000080088888888888800000008888888008888888000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888880
00000000222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222220
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000088888888888888888888000000000000000000008888888888880000000088888888888800000000000000000000000000008888888888880000888888
00000088888888888888888888000000000000000000008888888888880000000088888888888800000000000000000000000000008888888888880000888888
00000088888888888888888888000000000000000000008888888888880000000088888888888800000000000000000000000000008888888888880000888888
00000088888888888888888888000000000000000000008888888888880000000088888888888800000000000000000000000000008888888888880000888888
00000000008888888888880000000000000000000000000000888800000000000000008888888888880000000000000000000000000000888800000000000022
00000000008888888888880000000000000000000000000000888800000000000000008888888888880000000000000000000000000000888800000000000022
00000000008888888888880000000000000000000000000000888800000000000000008888888888880000000000000000000000000000888800000000000022
00000000008888888888880000000000000000000000000000888800000000000000008888888888880000000000000000000000000000888800000000000022
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888000000000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888000000000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888000000000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888000000000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888800000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888800000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888800000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888800000000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888888880000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888888880000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888888880000000000000000888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888888888888888888888880000000000000000888800000000000000
22000000008888888888880000000000000000000000000000888800000000000000008888000088888888888888888888000000000000888800000000000000
22000000008888888888880000000000000000000000000000888800000000000000008888000088888888888888888888000000000000888800000000000000
22000000008888888888880000000000000000000000000000888800000000000000008888000088888888888888888888000000000000888800000000000000
22000000008888888888880000000000000000000000000000888800000000000000008888000088888888888888888888000000000000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000008888888888888888888800000000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000008888888888888888888800000000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000008888888888888888888800000000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000008888888888888888888800000000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000888888888888888888880000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000888888888888888888880000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000888888888888888888880000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000888888888888888888880000888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000000088888888888888888888888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000000088888888888888888888888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000000088888888888888888888888800000000000000
88000000008888888888880000000000000000000000000000888800000000000000008888000000000000000088888888888888888888888800000000000000
22000000008888888888880000000000000000000000000000888800000000000000008888000000000000000000008888888888888888888800000000000000
22000000008888888888880000000000000000000000000000888800000000000000008888000000000000000000008888888888888888888800000000000000
22000000008888888888880000000000000000000000000000888800000000000000008888000000000000000000008888888888888888888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888000000000000000000000000888888888888888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888000000000000000000000000888888888888888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888000000000000000000000000888888888888888800000000000000
00000000008888888888880000000000000000000000000000888800000000000000008888000000000000000000000000888888888888888800000000000000
00000000002222888888880000000000000000000000000000888800000000000000008888000000000000000000000000000088888888888800000000000000
00000000002222888888880000000000000000000000000000888800000000000000008888000000000000000000000000000088888888888800000000000000
00000000002222888888880000000000000000000000000000888800000000000000008888000000000000000000000000000088888888888800000000000000
00000000002222888888880000000000000000000000000000888800000000000000008888000000000000000000000000000088888888888800000000000000
00000000000000888888882222000000000000000000008888222200000000000000008888000000000000000000000000000000008888888800000000000000
00000000000000888888882222000000000000000000008888222200000000000000008888000000000000000000000000000000008888888800000000000000
00000000000000888888882222000000000000000000008888222200000000000000008888000000000000000000000000000000008888888800000000000000
00000000000000888888882222000000000000000000008888222200000000000000008888000000000000000000000000000000008888888800000000000000
00000000000000222288888888000000000000000022228888000000000000000022228888222200000000000000000000000000002222888800000000000022
00000000000000222288888888000000000000000022228888000000000000000022228888222200000000000000000000000000002222888800000000000022
00000000000000222288888888000000000000000022228888000000000000000022228888222200000000000000000000000000002222888800000000000022
00000000000000222288888888000000000000000022228888000000000000000022228888222200000000000000000000000000002222888800000000000022
00000000000000000000002222888888888888888888880000000000000000888888888888888888880000000000000000000000000000888800000000888888
00000000000000000000002222888888888888888888880000000000000000888888888888888888880000000000000000000000000000888800000000888888
00000000000000000000002222888888888888888888880000000000000000888888888888888888880000000000000000000000000000888800000000888888
00000000000000000000002222888888888888888888880000000000000000888888888888888888880000000000000000000000000000888800000000888888
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

