pico-8 cartridge // http://www.pico-8.com
version 27
__lua__

--
-- constants/variables
--
q=64  -- shorthand for 1/2 screen size
w=118 -- shorthand for large number
i=0   -- ball x-pos
j=0   -- ball y-pos
u=q   -- ball dx (x-velocity)
v=q   -- ball dy (y-velocity)
o=0   -- ball dz (height/z-velocity)
h=9   -- ball z-pos (height)

--
-- (function shorthands)
--
r=rectfill
c=circfill
b=btn

-- 
-- player data (table) creation
--
g={
  {
    q,  -- x-pos
    w,  -- y-pos
    0,  -- dx (x-velocity)
    0,  -- dy (y-velocity)
    0,  -- last dx
    -3  -- last dy
  },
  {q,9,0,0,0,3} -- same again for player 2
}

function _update60()
  cls(5)            -- set background to dark grey
  r(53,4,75,123,0)  -- draw the goals (using a single call)
  r(9,9,w,w,3)      -- draw the playing area/pitch
  
  u+=i              -- move the ball's x-pos, based on x-velocity
  v+=j              -- move the ball's y-pos, based on y-velocity
  h+=o              -- move the ball's z-pos (height), based on z-velocity
  o-=.1             -- apply gravity to ball's z-velocity
  
  if(h<0)o*=-.7     -- if ball touches the floor, then "bounce"
                    -- (by inverting the z-velocity, slightly reduced)

  if(pget(u,v)<1)run()  -- if pixel colour at ball pos = black, then restart

  --
  -- (keep ball within play area by bouncing it off the walls)
  --
  if(u<9or u>w)i*=-1  -- if ball x-pos exceeds play area, invert x-velocity
  if(v<8or v>w)j*=-1  -- if ball y-pos exceeds play area, invert y-velocity

  -- 
  -- players
  --
  for a=0,1 do      -- loop through each player
    p=g[a+1]        -- get the current player object (table)
    
    p[3]=b(0,a)and-1or(b(1,a)and 1or 0) -- set dx based on left/right buttons
    p[4]=b(2,a)and-1or(b(3,a)and 1or 0) -- set dy based on up/down buttons

    d=p[3]          -- temp store player dx and dy into shorthand variables
    e=p[4]          -- 

    if(d!=0or e!=0)p[5]=d*3p[6]=e*3
                    -- if player is moving in any direction,
                    -- update the player's last dx & dy
                    -- (used to draw car direction facing)

    if(b(4,a))d*=2e*=2  -- if üÖæÔ∏è/z button pressed, 
                        -- boost player by doubling the movement velocity

    --
    -- (keep player within play area by clamping position)
    --
    p[1]=mid(14,p[1]+d,113) -- ensure the players x & y pos stays within range
    p[2]=mid(14,p[2]+e,113) -- 
    
    x=p[1]          -- temp store player x & y into shorthand variables
    y=p[2]          --

    fillp(w)        -- set the fill for subsequent draws to a pattern
    
    c(u,v,3)        -- draw the ball shadow
    c(u,v-h,4,w)    -- draw the ball, with a y-offset for current height

    if(5<pget(x,y)and h<1)o=abs(e)i=d j=e
                    -- if pixel col at player pos = ball AND ball height <1,
                    -- then "kick" the ball by setting it's:
                    --    x & y velocity to that of the player, and
                    --    z velocity (height) to a similar velocity
    --
    -- draw player
    --
    c(x,y,2,a+1)        -- draw front of the car (smaller circle)
    c(x-p[5],y-p[6],3)  -- draw the back (larger, at offset of last dx & dy)
  end
  fillp()           -- reset the fill pattern to "solid" for next cycle
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555000000000000000000000005555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555000000000000000000000005555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555000000000000000000000005555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555000000000000000000000005555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555000000000022200000000005555555555555555555555555555555555555555555555555555
55555555533333333333333333333333333333333333333333333333333333222223333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333330002000333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333330022002333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333332222222333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333222223333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333002003333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333022003333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333322233333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333366633333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333337776777333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333337766776333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333366666666633333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333366666666633333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333367776777633333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333337766776333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333336666666333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333366633333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333001003333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333330011001333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333331111111333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333331111111333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333001003333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333311033333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333311033333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333111113333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333111113333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333001003333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333330011001333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333331111111333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333331111111333333333333333333333333333333333333333333333333333555555555
55555555533333333333333333333333333333333333333333333333333333001003333333333333333333333333333333333333333333333333333555555555
55555555555555555555555555555555555555555555555555555000000000011000000000005555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555000000000000000000000005555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555000000000000000000000005555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555000000000000000000000005555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555000000000000000000000005555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555

